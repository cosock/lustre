local utils = require "lustre.utils"
local cosock = require "cosock"
describe("utils", function()
    describe("validate_utf8", function()
        it("will validate `Îºá½¹Ïƒ`  #o", function()
            assert(utils.validate_utf8("Îºá½¹Ïƒ"))
        end)
        it("will validate querty #e", function()
            local querty = "`1234567890-=~!@#$%^&*()_+ qwertyuiop[]\\QWERTYUIOP{}|asdfghjkl;'ASDFGHJKL:\"zxcvbnm,./ZXCVBNM<>?"
            local idx = 0
            for ch in string.gmatch(querty, '.') do
                idx = idx + 1
                local s, e = utils.validate_utf8(ch)
                assert(s, string.format("failed to validate query char: %q: %s", ch, e))
            end
            local s, e = utils.validate_utf8(querty)
            assert(s, string.format("failed to validate full querty set: %s", e))
        end)
        it("will validate emoji faces", function()
            local faces = "ğŸ˜ƒğŸ»ğŸ”âš½ğŸŒ‡ğŸ’¡ğŸ”£ğŸŒğŸ˜ƒğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ¤£ğŸ˜‚ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŠğŸ˜‡ğŸ¥°ğŸ˜ğŸ¤©ğŸ˜˜ğŸ˜—â˜ºï¸ğŸ˜šğŸ˜™ğŸ¥²ğŸ˜‹ğŸ˜›ğŸ˜œğŸ¤ªğŸ˜ğŸ¤‘ğŸ¤—ğŸ¤­ğŸ¤«ğŸ¤”ğŸ¤ğŸ¤¨ğŸ˜ğŸ˜‘ğŸ˜¶ğŸ˜¶â€ğŸŒ«ï¸ğŸ˜ğŸ˜’ğŸ™„ğŸ˜¬ğŸ˜®â€ğŸ’¨ğŸ¤¥ğŸ˜ŒğŸ˜”ğŸ˜ªğŸ¤¤ğŸ˜´ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤¢ğŸ¤®ğŸ¤§ğŸ¥µğŸ¥¶ğŸ¥´ğŸ˜µğŸ˜µâ€ğŸ’«ğŸ¤¯ğŸ¤ ğŸ¥³ğŸ¥¸ğŸ˜ğŸ¤“ğŸ§ğŸ˜•ğŸ˜ŸğŸ™â˜¹ï¸ğŸ˜®ğŸ˜¯ğŸ˜²ğŸ˜³ğŸ¥ºğŸ˜¦ğŸ˜§ğŸ˜¨ğŸ˜°ğŸ˜¥ğŸ˜¢ğŸ˜­ğŸ˜±ğŸ˜–ğŸ˜£ğŸ˜ğŸ˜“ğŸ˜©ğŸ˜«ğŸ¥±ğŸ˜¤ğŸ˜¡ğŸ˜ ğŸ¤¬ğŸ˜ˆğŸ‘¿ğŸ’€â˜ ï¸ğŸ’©ğŸ¤¡ğŸ‘¹ğŸ‘ºğŸ‘»ğŸ‘½ğŸ‘¾ğŸ¤–ğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾ğŸ’‹ğŸ‘‹ğŸ¤šğŸ–ï¸âœ‹ğŸ––ğŸ‘ŒğŸ¤ŒğŸ¤âœŒï¸ğŸ¤ğŸ¤ŸğŸ¤˜ğŸ¤™ğŸ‘ˆğŸ‘‰ğŸ‘†ğŸ–•ğŸ‘‡â˜ï¸ğŸ‘ğŸ‘âœŠğŸ‘ŠğŸ¤›ğŸ¤œğŸ‘ğŸ™ŒğŸ‘ğŸ¤²ğŸ¤ğŸ™âœï¸ğŸ’…ğŸ¤³ğŸ’ªğŸ¦¾ğŸ¦¿ğŸ¦µğŸ¦¶ğŸ‘‚ğŸ¦»ğŸ‘ƒğŸ§ ğŸ«€ğŸ«ğŸ¦·ğŸ¦´ğŸ‘€ğŸ‘ï¸ğŸ‘…ğŸ‘„ğŸ‘¶ğŸ§’ğŸ‘¦ğŸ‘§ğŸ§‘ğŸ‘±ğŸ‘¨ğŸ§”ğŸ‘¨â€ğŸ¦°ğŸ‘¨â€ğŸ¦±ğŸ‘¨â€ğŸ¦³ğŸ‘¨â€ğŸ¦²ğŸ‘©ğŸ‘©â€ğŸ¦°ğŸ§‘â€ğŸ¦°ğŸ‘©â€ğŸ¦±ğŸ§‘â€ğŸ¦±ğŸ‘©â€ğŸ¦³ğŸ§‘â€ğŸ¦³ğŸ‘©â€ğŸ¦²ğŸ§‘â€ğŸ¦²ğŸ‘±â€â™€ï¸ğŸ‘±â€â™‚ï¸ğŸ§“ğŸ‘´ğŸ‘µğŸ™ğŸ™â€â™‚ï¸ğŸ™â€â™€ï¸ğŸ™ğŸ™â€â™‚ï¸ğŸ™â€â™€ï¸ğŸ™…ğŸ™…â€â™‚ï¸ğŸ™…â€â™€ï¸ğŸ™†ğŸ™†â€â™‚ï¸ğŸ™†â€â™€ï¸ğŸ’ğŸ’â€â™‚ï¸ğŸ’â€â™€ï¸ğŸ™‹ğŸ™‹â€â™‚ï¸ğŸ™‹â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ™‡ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™€ï¸ğŸ¤¦ğŸ¤¦â€â™‚ï¸ğŸ¤¦â€â™€ï¸ğŸ¤·ğŸ¤·â€â™‚ï¸ğŸ¤·â€â™€ï¸ğŸ§‘â€âš•ï¸ğŸ‘¨â€âš•ï¸ğŸ‘©â€âš•ï¸ğŸ§‘â€ğŸ“ğŸ‘¨â€ğŸ“ğŸ‘©â€ğŸ“ğŸ§‘â€ğŸ«ğŸ‘¨â€ğŸ«ğŸ‘©â€ğŸ«ğŸ§‘â€âš–ï¸ğŸ‘¨â€âš–ï¸ğŸ‘©â€âš–ï¸ğŸ§‘â€ğŸŒ¾ğŸ‘¨â€ğŸŒ¾ğŸ‘©â€ğŸŒ¾ğŸ§‘â€ğŸ³ğŸ‘¨â€ğŸ³ğŸ‘©â€ğŸ³ğŸ§‘â€ğŸ”§ğŸ‘¨â€ğŸ”§ğŸ‘©â€ğŸ”§ğŸ§‘â€ğŸ­ğŸ‘¨â€ğŸ­ğŸ‘©â€ğŸ­ğŸ§‘â€ğŸ’¼ğŸ‘¨â€ğŸ’¼ğŸ‘©â€ğŸ’¼ğŸ§‘â€ğŸ”¬ğŸ‘¨â€ğŸ”¬ğŸ‘©â€ğŸ”¬ğŸ§‘â€ğŸ’»ğŸ‘¨â€ğŸ’»ğŸ‘©â€ğŸ’»ğŸ§‘â€ğŸ¤ğŸ‘¨â€ğŸ¤ğŸ‘©â€ğŸ¤ğŸ§‘â€ğŸ¨ğŸ‘¨â€ğŸ¨ğŸ‘©â€ğŸ¨ğŸ§‘â€âœˆï¸ğŸ‘¨â€âœˆï¸ğŸ‘©â€âœˆï¸ğŸ§‘â€ğŸš€ğŸ‘¨â€ğŸš€ğŸ‘©â€ğŸš€ğŸ§‘â€ğŸš’ğŸ‘¨â€ğŸš’ğŸ‘©â€ğŸš’ğŸ‘®ğŸ‘®â€â™‚ï¸ğŸ‘®â€â™€ï¸ğŸ•µï¸ğŸ•µï¸â€â™‚ï¸ğŸ•µï¸â€â™€ï¸ğŸ’‚ğŸ’‚â€â™‚ï¸ğŸ’‚â€â™€ï¸ğŸ¥·ğŸ‘·ğŸ‘·â€â™‚ï¸ğŸ‘·â€â™€ï¸ğŸ¤´ğŸ‘¸ğŸ‘³ğŸ‘³â€â™‚ï¸ğŸ‘³â€â™€ï¸ğŸ‘²ğŸ§•ğŸ¤µğŸ¤µâ€â™‚ï¸ğŸ¤µâ€â™€ï¸ğŸ‘°ğŸ‘°â€â™‚ï¸ğŸ‘°â€â™€ï¸ğŸ¤°ğŸ¤±ğŸ‘©â€ğŸ¼ğŸ‘¨â€ğŸ¼ğŸ§‘â€ğŸ¼ğŸ‘¼ğŸ…ğŸ¤¶ğŸ§‘â€ğŸ„ğŸ¦¸ğŸ¦¸â€â™‚ï¸ğŸ¦¸â€â™€ï¸ğŸ¦¹ğŸ¦¹â€â™‚ï¸ğŸ¦¹â€â™€ï¸ğŸ§™ğŸ§™â€â™‚ï¸ğŸ§™â€â™€ï¸ğŸ§šğŸ§šâ€â™‚ï¸ğŸ§šâ€â™€ï¸ğŸ§›ğŸ§›â€â™‚ï¸ğŸ§›â€â™€ï¸ğŸ§œğŸ§œâ€â™‚ï¸ğŸ§œâ€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ŸğŸ§Ÿâ€â™‚ï¸ğŸ§Ÿâ€â™€ï¸ğŸ’†ğŸ’†â€â™‚ï¸ğŸ’†â€â™€ï¸ğŸ’‡ğŸ’‡â€â™‚ï¸ğŸ’‡â€â™€ï¸ğŸš¶ğŸš¶â€â™‚ï¸ğŸš¶â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§ğŸ§â€â™‚ï¸ğŸ§â€â™€ï¸ğŸ§‘â€ğŸ¦¯ğŸ‘¨â€ğŸ¦¯ğŸ‘©â€ğŸ¦¯ğŸ§‘â€ğŸ¦¼ğŸ‘¨â€ğŸ¦¼ğŸ‘©â€ğŸ¦¼ğŸ§‘â€ğŸ¦½ğŸ‘¨â€ğŸ¦½ğŸ‘©â€ğŸ¦½ğŸƒğŸƒâ€â™‚ï¸ğŸƒâ€â™€ï¸ğŸ’ƒğŸ•ºğŸ•´ï¸ğŸ‘¯ğŸ‘¯â€â™‚ï¸ğŸ‘¯â€â™€ï¸ğŸ§–ğŸ§–â€â™‚ï¸ğŸ§–â€â™€ï¸ğŸ§˜ğŸ§‘â€ğŸ¤â€ğŸ§‘ğŸ‘­ğŸ‘«ğŸ‘¬ğŸ’ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ğŸ‘¨â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©ğŸ’‘ğŸ‘©â€â¤ï¸â€ğŸ‘¨ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ğŸ‘©â€â¤ï¸â€ğŸ‘©ğŸ‘ªğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ğŸ‘©â€ğŸ‘©â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘§ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ‘¨â€ğŸ‘¦ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦ğŸ‘¨â€ğŸ‘§ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ğŸ‘©â€ğŸ‘¦ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ğŸ‘©â€ğŸ‘§ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ğŸ‘©â€ğŸ‘§â€ğŸ‘§ğŸ—£ï¸ğŸ‘¤ğŸ‘¥ğŸ«‚ğŸ‘£ğŸ§³ğŸŒ‚â˜‚ï¸ğŸƒğŸ§µğŸ§¶ğŸ‘“ğŸ•¶ï¸ğŸ¥½ğŸ¥¼ğŸ¦ºğŸ‘”ğŸ‘•ğŸ‘–ğŸ§£ğŸ§¤ğŸ§¥ğŸ§¦ğŸ‘—ğŸ‘˜ğŸ¥»ğŸ©±ğŸ©²ğŸ©³ğŸ‘™ğŸ‘šğŸ‘›ğŸ‘œğŸ‘ğŸ’ğŸ©´ğŸ‘ğŸ‘ŸğŸ¥¾ğŸ¥¿ğŸ‘ ğŸ‘¡ğŸ©°ğŸ‘¢ğŸ‘‘ğŸ‘’ğŸ©ğŸ“ğŸ§¢ğŸª–â›‘ï¸ğŸ’„ğŸ’ğŸ’¼ğŸ©¸ğŸ˜ƒğŸ»ğŸ”âš½ğŸŒ‡ğŸ’¡ğŸ”£ğŸŒâ¤ï¸âœ¨ğŸ”¥ğŸ˜Šâœ”ï¸ğŸ˜‚ğŸ‘ğŸ¥°ğŸ¥ºğŸğŸ‘€ğŸ“ˆğŸ„ğŸ’‘ğŸªŸğŸ¦ƒğŸ§”ğŸ‡¦ğŸ‡ºğŸ‡«ğŸ‡·ğŸ‚ğŸ›ï¸âœŠğŸ¿ğŸ‡¨ğŸ‡¦ğŸ‡§ğŸ‡·ğŸ‰ğŸ…ğŸ‡²ğŸ‡½ğŸ¦ ğŸª”ğŸ‡¨ğŸ‡³ğŸŒ±ğŸ°ğŸ¥ğŸ‚ğŸ‘¨ğŸ’ªğŸŒ¿ğŸ“ğŸ”¥ğŸƒğŸ•ğŸ’•ğŸ•‰ï¸ğŸ‡ºğŸ‡¸â™€ï¸ğŸ¤±ğŸŠğŸ”ğŸŠğŸ³ï¸â€ğŸŒˆğŸ­ğŸ‘‘â˜ªï¸ğŸŒ±â˜˜ï¸â˜€ï¸ğŸˆğŸ¦ƒğŸ’˜ğŸ–ï¸ğŸ‘°â›„ğŸ¿ğŸ¡âš½ğŸŒ"
            local s, e = utils.validate_utf8(faces)
            assert(s, string.format("failed to validate faces set: %s", e))
        end)
        it("will validate emoji flags", function()
            local flags = "ğŸğŸš©ğŸ´ğŸ³ï¸ğŸ³ï¸â€ğŸŒˆğŸ³ï¸â€âš§ï¸ğŸ´â€â˜ ï¸ğŸ‡¦ğŸ‡¨ğŸ‡¦ğŸ‡©ğŸ‡¦ğŸ‡ªğŸ‡¦ğŸ‡«ğŸ‡¦ğŸ‡¬ğŸ‡¦ğŸ‡®ğŸ‡¦ğŸ‡±ğŸ‡¦ğŸ‡²ğŸ‡¦ğŸ‡´ğŸ‡¦ğŸ‡¶ğŸ‡¦ğŸ‡·ğŸ‡¦ğŸ‡¸ğŸ‡¦ğŸ‡¹ğŸ‡¦ğŸ‡ºğŸ‡¦ğŸ‡¼ğŸ‡¦ğŸ‡½ğŸ‡¦ğŸ‡¿ğŸ‡§ğŸ‡¦ğŸ‡§ğŸ‡§ğŸ‡§ğŸ‡©ğŸ‡§ğŸ‡ªğŸ‡§ğŸ‡«ğŸ‡§ğŸ‡¬ğŸ‡§ğŸ‡­ğŸ‡§ğŸ‡®ğŸ‡§ğŸ‡¯ğŸ‡§ğŸ‡±ğŸ‡§ğŸ‡²ğŸ‡§ğŸ‡³ğŸ‡§ğŸ‡´ğŸ‡§ğŸ‡¶ğŸ‡§ğŸ‡·ğŸ‡§ğŸ‡¸ğŸ‡§ğŸ‡¹ğŸ‡§ğŸ‡»ğŸ‡§ğŸ‡¼ğŸ‡§ğŸ‡¾ğŸ‡§ğŸ‡¿ğŸ‡¨ğŸ‡¦ğŸ‡¨ğŸ‡¨ğŸ‡¨ğŸ‡©ğŸ‡¨ğŸ‡«ğŸ‡¨ğŸ‡¬ğŸ‡¨ğŸ‡­ğŸ‡¨ğŸ‡®ğŸ‡¨ğŸ‡°ğŸ‡¨ğŸ‡±ğŸ‡¨ğŸ‡²ğŸ‡¨ğŸ‡³ğŸ‡¨ğŸ‡´ğŸ‡¨ğŸ‡µğŸ‡¨ğŸ‡·ğŸ‡¨ğŸ‡ºğŸ‡¨ğŸ‡»ğŸ‡¨ğŸ‡¼ğŸ‡¨ğŸ‡½ğŸ‡¨ğŸ‡¾ğŸ‡¨ğŸ‡¿ğŸ‡©ğŸ‡ªğŸ‡©ğŸ‡¬ğŸ‡©ğŸ‡¯ğŸ‡©ğŸ‡°ğŸ‡©ğŸ‡²ğŸ‡©ğŸ‡´ğŸ‡©ğŸ‡¿ğŸ‡ªğŸ‡¦ğŸ‡ªğŸ‡¨ğŸ‡ªğŸ‡ªğŸ‡ªğŸ‡¬ğŸ‡ªğŸ‡­ğŸ‡ªğŸ‡·ğŸ‡ªğŸ‡¸ğŸ‡ªğŸ‡¹ğŸ‡ªğŸ‡ºğŸ‡«ğŸ‡®ğŸ‡«ğŸ‡¯ğŸ‡«ğŸ‡°ğŸ‡«ğŸ‡²ğŸ‡«ğŸ‡´ğŸ‡«ğŸ‡·ğŸ‡¬ğŸ‡¦ğŸ‡¬ğŸ‡§ğŸ‡¬ğŸ‡©ğŸ‡¬ğŸ‡ªğŸ‡¬ğŸ‡«ğŸ‡¬ğŸ‡¬ğŸ‡¬ğŸ‡­ğŸ‡¬ğŸ‡®ğŸ‡¬ğŸ‡±ğŸ‡¬ğŸ‡²ğŸ‡¬ğŸ‡³ğŸ‡¬ğŸ‡µğŸ‡¬ğŸ‡¶ğŸ‡¬ğŸ‡·ğŸ‡¬ğŸ‡¸ğŸ‡¬ğŸ‡¹ğŸ‡¬ğŸ‡ºğŸ‡¬ğŸ‡¼ğŸ‡¬ğŸ‡¾ğŸ‡­ğŸ‡°ğŸ‡­ğŸ‡²ğŸ‡­ğŸ‡³ğŸ‡­ğŸ‡·ğŸ‡­ğŸ‡¹ğŸ‡­ğŸ‡ºğŸ‡®ğŸ‡¨ğŸ‡®ğŸ‡©ğŸ‡®ğŸ‡ªğŸ‡®ğŸ‡±ğŸ‡®ğŸ‡²ğŸ‡®ğŸ‡³ğŸ‡®ğŸ‡´ğŸ‡®ğŸ‡¶ğŸ‡®ğŸ‡·ğŸ‡®ğŸ‡¸ğŸ‡®ğŸ‡¹ğŸ‡¯ğŸ‡ªğŸ‡¯ğŸ‡²ğŸ‡¯ğŸ‡´ğŸ‡¯ğŸ‡µğŸ‡°ğŸ‡ªğŸ‡°ğŸ‡¬ğŸ‡°ğŸ‡­ğŸ‡°ğŸ‡®ğŸ‡°ğŸ‡²ğŸ‡°ğŸ‡³ğŸ‡°ğŸ‡µğŸ‡°ğŸ‡·ğŸ‡°ğŸ‡¼ğŸ‡°ğŸ‡¾ğŸ‡°ğŸ‡¿ğŸ‡±ğŸ‡¦ğŸ‡±ğŸ‡§ğŸ‡±ğŸ‡¨ğŸ‡±ğŸ‡®ğŸ‡±ğŸ‡°ğŸ‡±ğŸ‡·ğŸ‡±ğŸ‡¸ğŸ‡±ğŸ‡¹ğŸ‡±ğŸ‡ºğŸ‡±ğŸ‡»ğŸ‡±ğŸ‡¾ğŸ‡²ğŸ‡¦ğŸ‡²ğŸ‡¨ğŸ‡²ğŸ‡©ğŸ‡²ğŸ‡ªğŸ‡²ğŸ‡«ğŸ‡²ğŸ‡¬ğŸ‡²ğŸ‡­ğŸ‡²ğŸ‡°ğŸ‡²ğŸ‡±ğŸ‡²ğŸ‡²ğŸ‡²ğŸ‡³ğŸ‡²ğŸ‡´ğŸ‡²ğŸ‡µğŸ‡²ğŸ‡¶ğŸ‡²ğŸ‡·ğŸ‡²ğŸ‡¸ğŸ‡²ğŸ‡¹ğŸ‡²ğŸ‡ºğŸ‡²ğŸ‡»ğŸ‡²ğŸ‡¼ğŸ‡²ğŸ‡½ğŸ‡²ğŸ‡¾ğŸ‡²ğŸ‡¿ğŸ‡³ğŸ‡¦ğŸ‡³ğŸ‡¨ğŸ‡³ğŸ‡ªğŸ‡³ğŸ‡«ğŸ‡³ğŸ‡¬ğŸ‡³ğŸ‡®ğŸ‡³ğŸ‡±ğŸ‡³ğŸ‡´ğŸ‡³ğŸ‡µğŸ‡³ğŸ‡·ğŸ‡³ğŸ‡ºğŸ‡³ğŸ‡¿ğŸ‡´ğŸ‡²ğŸ‡µğŸ‡¦ğŸ‡µğŸ‡ªğŸ‡µğŸ‡«ğŸ‡µğŸ‡¬ğŸ‡µğŸ‡­ğŸ‡µğŸ‡°ğŸ‡µğŸ‡±ğŸ‡µğŸ‡²ğŸ‡µğŸ‡³ğŸ‡µğŸ‡·ğŸ‡µğŸ‡¸ğŸ‡µğŸ‡¹ğŸ‡µğŸ‡¼ğŸ‡µğŸ‡¾ğŸ‡¶ğŸ‡¦ğŸ‡·ğŸ‡ªğŸ‡·ğŸ‡´ğŸ‡·ğŸ‡¸ğŸ‡·ğŸ‡ºğŸ‡·ğŸ‡¼ğŸ‡¸ğŸ‡¦ğŸ‡¸ğŸ‡§ğŸ‡¸ğŸ‡¨ğŸ‡¸ğŸ‡©ğŸ‡¸ğŸ‡ªğŸ‡¸ğŸ‡¬ğŸ‡¸ğŸ‡­ğŸ‡¸ğŸ‡®ğŸ‡¸ğŸ‡¯ğŸ‡¸ğŸ‡°ğŸ‡¸ğŸ‡±ğŸ‡¸ğŸ‡²ğŸ‡¸ğŸ‡³ğŸ‡¸ğŸ‡´ğŸ‡¸ğŸ‡·ğŸ‡¸ğŸ‡¸ğŸ‡¸ğŸ‡¹ğŸ‡¸ğŸ‡»ğŸ‡¸ğŸ‡½ğŸ‡¸ğŸ‡¾ğŸ‡¸ğŸ‡¿ğŸ‡¹ğŸ‡¦ğŸ‡¹ğŸ‡¨ğŸ‡¹ğŸ‡©ğŸ‡¹ğŸ‡«ğŸ‡¹ğŸ‡¬ğŸ‡¹ğŸ‡­ğŸ‡¹ğŸ‡¯ğŸ‡¹ğŸ‡°ğŸ‡¹ğŸ‡±ğŸ‡¹ğŸ‡²ğŸ‡¹ğŸ‡³ğŸ‡¹ğŸ‡´ğŸ‡¹ğŸ‡·ğŸ‡¹ğŸ‡¹ğŸ‡¹ğŸ‡»ğŸ‡¹ğŸ‡¼ğŸ‡¹ğŸ‡¿ğŸ‡ºğŸ‡¦ğŸ‡ºğŸ‡¬ğŸ‡ºğŸ‡²ğŸ‡ºğŸ‡³ğŸ‡ºğŸ‡¸ğŸ‡ºğŸ‡¾ğŸ‡ºğŸ‡¿ğŸ‡»ğŸ‡¦ğŸ‡»ğŸ‡¨ğŸ‡»ğŸ‡ªğŸ‡»ğŸ‡¬ğŸ‡»ğŸ‡®ğŸ‡»ğŸ‡³ğŸ‡»ğŸ‡ºğŸ‡¼ğŸ‡«ğŸ‡¼ğŸ‡¸ğŸ‡½ğŸ‡°ğŸ‡¾ğŸ‡ªğŸ‡¾ğŸ‡¹ğŸ‡¿ğŸ‡¦ğŸ‡¿ğŸ‡²ğŸ‡¿ğŸ‡¼ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ğŸ³â€ğŸŸ§â€â¬›â€ğŸŸ§ğŸ´ó µó ³ó ´ó ¸ó ¿ğŸ˜ƒğŸ»ğŸ”âš½ğŸŒ‡ğŸ’¡ğŸ”£ğŸŒâ¤ï¸âœ¨ğŸ”¥ğŸ˜Šâœ”ï¸ğŸ˜‚ğŸ‘ğŸ¥°ğŸ¥ºğŸğŸ‘€ğŸ“ˆğŸ„ğŸ’‘ğŸªŸğŸ¦ƒğŸ§”ğŸ‡¦ğŸ‡ºğŸ‡«ğŸ‡·ğŸ‚ğŸ›ï¸âœŠğŸ¿ğŸ‡¨ğŸ‡¦ğŸ‡§ğŸ‡·ğŸ‰ğŸ…ğŸ‡²ğŸ‡½ğŸ¦ ğŸª”ğŸ‡¨ğŸ‡³ğŸŒ±ğŸ°ğŸ¥ğŸ‚ğŸ‘¨ğŸ’ªğŸŒ¿ğŸ“ğŸ”¥ğŸƒğŸ•ğŸ’•ğŸ•‰ï¸ğŸ‡ºğŸ‡¸â™€ï¸ğŸ¤±ğŸŠğŸ”ğŸŠğŸ³ï¸â€ğŸŒˆğŸ­ğŸ‘‘â˜ªï¸ğŸŒ±â˜˜ï¸â˜€ï¸ğŸˆğŸ¦ƒğŸ’˜ğŸ–ï¸ğŸ‘°â›„ğŸ¿ğŸ¡âš½ğŸŒ"
            local s, e = utils.validate_utf8(flags)
            assert(s, string.format("failed to validate faces set: %s", e))
        end)
        it("will validate cjk sample", function()
            local chars = "ğ €€ğ €ğ €‚ğ €ƒğ €„ğ €…ğ €†ğ €‡ğ €ˆğ €‰ğ €Šğ €‹ğ €Œğ €ğ €ğ €ğ €ğ €‘ğ €’ğ €“ğ €”ğ €•ğ €–ğ €—ğ €˜ğ €™ğ €šğ €›ğ €œğ €ğ €ğ €Ÿğ € ğ €¡ğ €¢ğ €£ğ €¤ğ €¥ğ €¦ğ €§ğ €¨ğ €©ğ €ªğ €«ğ €¬ğ €­ğ €®ğ €¯ğ €°ğ €±ğ €²ğ €³ğ €´ğ €µğ €¶ğ €·ğ €¸ğ €¹ğ €ºğ €»ğ €¼ğ €½ğ €¾ğ €¿ğ €ğ ğ ‚ğ ƒğ „ğ …ğ †ğ ‡ğ ˆğ ‰ğ Šğ ‹ğ Œğ ğ ğ ğ ğ ‘ğ ’ğ “ğ ”ğ •ğ –ğ —ğ ˜ğ ™ğ šğ ›ğ œğ ğ ğ Ÿğ  ğ ¡ğ ¢ğ £ğ ¤ğ ¥ğ ¦ğ §ğ ¨ğ ©ğ ªğ «ğ ¬ğ ­ğ ®ğ ¯ğ °ğ ±ğ ²ğ ³ğ ´ğ µğ ¶ğ ·ğ ¸ğ ¹ğ ºğ »ğ ¼ğ ½ğ ¾ğ ¿ğ ‚€ğ ‚ğ ‚‚ğ ‚ƒğ ‚„ğ ‚…ğ ‚†ğ ‚‡ğ ‚ˆğ ‚‰ğ ‚Šğ ‚‹ğ ‚Œğ ‚ğ ‚ğ ‚ğ ‚ğ ‚‘ğ ‚’ğ ‚“ğ ‚”ğ ‚•ğ ‚–ğ ‚—ğ ‚˜ğ ‚™ğ ‚šğ ‚›ğ ‚œğ ‚ğ ‚ğ ‚Ÿğ ‚ ğ ‚¡ğ ‚¢ğ ‚£ğ ‚¤ğ ‚¥ğ ‚¦ğ ‚§ğ ‚¨ğ ‚©ğ ‚ªğ ‚«ğ ‚¬ğ ‚­ğ ‚®ğ ‚¯ğ ‚°ğ ‚±ğ ‚²ğ ‚³ğ ‚´ğ ‚µğ ‚¶ğ ‚·ğ ‚¸ğ ‚¹ğ ‚ºğ ‚»ğ ‚¼ğ ‚½ğ ‚¾ğ ‚¿ğ ƒ€ğ ƒğ ƒ‚ğ ƒƒğ ƒ„ğ ƒ…ğ ƒ†ğ ƒ‡ğ ƒˆğ ƒ‰ğ ƒŠğ ƒ‹ğ ƒŒğ ƒğ ƒğ ƒğ ƒğ ƒ‘ğ ƒ’ğ ƒ“ğ ƒ”ğ ƒ•ğ ƒ–ğ ƒ—ğ ƒ˜ğ ƒ™ğ ƒšğ ƒ›ğ ƒœğ ƒğ ƒğ ƒŸğ ƒ ğ ƒ¡ğ ƒ¢ğ ƒ£ğ ƒ¤ğ ƒ¥ğ ƒ¦ğ ƒ§ğ ƒ¨ğ ƒ©ğ ƒªğ ƒ«ğ ƒ¬ğ ƒ­ğ ƒ®ğ ƒ¯ğ ƒ°ğ ƒ±ğ ƒ²ğ ƒ³ğ ƒ´ğ ƒµğ ƒ¶ğ ƒ·ğ ƒ¸ğ ƒ¹ğ ƒºğ ƒ»ğ ƒ¼ğ ƒ½ğ ƒ¾ğ ƒ¿"
            local s, e = utils.validate_utf8(chars)
            assert(s, string.format("failed to validate cjk sample: %s", e))
        end)
        it("will validate `Îºá½¹ÏƒÎ¼Îµ`", function()
            local chars = "Îºá½¹ÏƒÎ¼Îµ"
            local s, e = utils.validate_utf8(chars)
            assert(s, string.format("failed to validate greek sample: %s", e))
        end)
        it("will fail `Îºá½¹ÏƒÎ¼Îµï¿½ï¿½ï¿½edited` #d", function()
            local input = string.char(0xce,0xba,0xe1,0xbd,0xb9,0xcf,0x83,0xce,0xbc,0xce,0xb5,0xed,0xa0,0x80,0x65,0x64,0x69,0x74,0x65,0x64)
            local success, error = utils.validate_utf8(input)
            assert(not success, string.format("expected to be valid %q", input))
        end)
        it("will fail invalid 4byte sequence in long bytes #v", function()
            local input = string.char(0xce,0xba,0xe1,0xbd,0xb9,0xcf,0x83,0xce,0xbc,0xce,0xb5,0xf4,0x90,0x80,0x80,0x65,0x64,0x69,0x74,0x65,0x64)
            local s, e = utils.validate_utf8(input)
            assert(not s)
        end)
        it("will fail two byte invalid continue", function()
            local inputs = {}
            for i = 0xC0, 0xDF do
                table.insert(inputs, {
                    value = string.char(i).." ",
                    error = "Invalid UTF-8 Sequence Continue"
                })
            end
            for _, input in ipairs(inputs) do
                local s, e = utils.validate_utf8(input.value)
                assert(not s, "Expected error in invalid two byte continue"..input.value)
            end
        end)
        it("will fail three byte invalid continue", function()
            local inputs = {}
            for i = 0xE0, 0xEF do
                table.insert(inputs, {
                    value = string.char(i).." ",
                    error = "Invalid UTF-8 Sequence Continue"
                })
            end
            for _, input in ipairs(inputs) do
                local s, e = utils.validate_utf8(input.value)
                assert(not s, "Expected error in invalid three byte continue"..input.value)
            end
        end)
        it("will fail four byte invalid continue", function()
            local inputs = {}
            for i = 0xF0, 0xF7 do
                table.insert(inputs, {
                    value = string.char(i).." ",
                    error = "Invalid UTF-8 Sequence Continue"
                })
            end
            for _, input in ipairs(inputs) do
                local s, e = utils.validate_utf8(input.value)
                assert(not s, "Expected error in invalid four byte continue"..input.value)
            end
        end)
        it("fails on single byte trailer", function()
            local s, e = utils.validate_utf8(string.char(0x80))
            assert(not s)
        end)
        it("returns nil for bad input #q", function()
            local inputs = {
                { value = string.char(0xBF), error = ""},
                { value = string.char(0xC0), error = ""},
                { value = string.char(0xE0), error = ""},
                { value = string.char(0xE0, 0x80), error = ""},
                { value = string.char(0xF0), error = ""},
                { value = string.char(0xF0, 0x80), error = ""},
                { value = string.char(0xF0, 0x80, 0x80), error = ""},
                { value = string.char(0xFE), error = ""},
                { value = string.char(0xFF), error = ""},
                { value = string.char(0xc0, 0xaf), error = ""},
              }
            for i, input in ipairs(inputs) do
                local success, error = utils.validate_utf8(input.value)
                assert(not success, string.format("%s expected to be invalid %s", i, input))
            end
        end)
        it("problematic 2 byte pair #r", function ()
            local success, error = utils.validate_utf8(string.char(0xc0, 0xaf))
            assert(not success)
            assert(error == "Invalid UTF-8 Length")
        end)
        describe("validates in under 100s #w", function()
            it("4 * 2^20", function()
                local bytes = string.rep("abcd", 2^20)
                local s = os.time()
                assert(utils.validate_utf8(bytes))
                local e = os.time()
                assert(os.difftime(s, e) < 100, string.format("validating 4*2^20 bytes took >100 s %s", os.difftime(s, e)))
            end)
            -- it("16 * 2^20 ", function()
            --     local bytes = string.rep(
            --         string.rep("BAsd7&jh23", 2),
            --         2 ^ 20
            --     )
            --     bytes = string.sub(bytes, 1, 16 * 2 ^ 20)
            --     local s = os.time()
            --     assert(utils.validate_utf8(bytes))
            --     local e = os.time()
            --     assert(os.difftime(s, e) < 100, string.format("validating 16*2^20 bytes took >100 s %s", os.difftime(s, e)))
            -- end)
        end)
    end)
end)
